<script src="{{=URL('static', 'js/moment.min.js')}}"></script>
<script src="{{=URL('static', 'js/fullcalendar.js')}}"></script>
<script src="{{=URL('static', 'js/lms299calendar.js')}}"></script>
<script>
  $(document).ready(function() {
    $('#calendar').lmsCalendar({
      height: 500,
      header: {
        left:   'today prevYear,prev,next,nextYear',
        center: 'title',
        right:  'month,agendaWeek,agendaDay'
      },
      events: {{=XML('\'' + URL('calendar', 'index.json') + '\'')}},
      {{if auth.is_logged_in():
          #is_teacher = db(db.auth_user.id == auth.user_id).select(db.auth_user.is_teacher).first().is_teacher
          #is_administrator = db(db.auth_user.id == auth.user_id).select(db.auth_user.is_administrator).first().is_administrator
          if (CAN_MANAGE_EVENTS):}}
            dayClick: function(date, jsEvent, view) {
              if(confirm("Do you want to create a new event on " + date.format() + "?")) {
                window.location.href = "{{=URL('calendar', 'create') + '/'}}" + date.format();
              }
            },
            eventClick: function(event, jsEvent, view) {
              if(confirm("Do you want to edit this event: " + event.title + "?")) {
                window.location.href = "{{=URL('calendar', 'update') + '/'}}" + event.id;
              }
            },
          {{pass}}
      {{pass}}
      selectable: false
    });
  });
</script>
