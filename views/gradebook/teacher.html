{{extend 'layout.html'}}


<h1>Welcome to Grade Interface</h1>
<a class="btn btn-primary" href="{{=URL('student',args=section_id)}}"> Student</a>




<div id="dataTable" class="handsontable"></div>
<button class="btn btn-primary" name="save" > Save</button>


<div id="example1console"></div>


<script>
 var data = [
 {{for row in users:}}
     {
       id:  '{{=row.auth_user.id }}',
       name: '{{=row.auth_user.first_name  + " " + row.auth_user.last_name}}',
       hw: {
             {{for hw in row.score:}}
                 '{{=hw.homework.id}}':{{if hw.assignment_grade.grade:}}
                                            '{{=hw.assignment_grade.grade}}'
                                    {{else:}}
                                            ''
                                    {{pass}}
            ,

            {{pass}}
        }
      },
  {{pass}}
  ];



  $('#dataTable').handsontable({
    data: data,
    columnSorting: true,
    contextMenu: true,
    currentRowClassName: 'currentRow',
    currentColClassName: 'currentCol',
    fixedColumnsLeft: 2,
    cells: function (row, col, prop) {
        var cellProperties = {}
        if(col === 0 ||col === 1  ) {
          cellProperties.readOnly = true;
        }
        return cellProperties;
    },
    colHeaders: true,
    columns: [
      {data: "id"},
      {data: "name"}
        {{for hw in names:}}
       ,{
            data: "hw.{{=hw.homework.id}}", title: "{{=hw.homework.name}}"
        }

        {{pass}}
    ],
  });

 var $console = $("#example1console");
 var handsontable = $('#dataTable').data('handsontable');

    $("button[name='save']").click(function () {
      $.ajax({
        url: "{{=URL('savedata',args=section_id)}}",
        data: JSON.stringify({"data": handsontable.getData()}), //returns all cells' data
        dataType: 'json',
        type: 'POST',
        success: function (res) {
            if(res)
            {
                $console.text(JSON.stringify(res, undefined, 2));
            }
             else {
                $console.text('Save error');
            }
        },
        error: function () {
          $console.text("Error something didn't work");
        }
      });
    });

</script>